<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÖÿ™ÿ¨ÿ± XYH - ŸÖÿ™ÿ¨ÿ±ŸÉ ÿßŸÑŸÖŸÅÿ∂ŸÑ ŸÑŸÑŸÖŸÑÿßÿ®ÿ≥ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿ©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            background-color: #f8fafc;
            color: #1e293b;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #3b82f6;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
        }

        .nav-menu a {
            text-decoration: none;
            color: #374151;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-menu a:hover {
            color: #3b82f6;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 10px 40px 10px 15px;
            width: 250px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }

        .cart-btn {
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Hero Slider */
        .hero-slider {
            position: relative;
            height: 320px; /* smaller hero to reduce vertical space */
            overflow: hidden;
            margin-bottom: 24px;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slide.active {
            opacity: 1;
        }

        .slide-content {
            background-color: rgba(0,0,0,0.35);
            color: white;
            padding: 18px;
            border-radius: 8px;
            text-align: center;
            max-width: 520px;
        }

        .slide-content h2 {
            font-size: 1.6rem;
            margin-bottom: 10px;
        }

        .slide-content p {
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .slider-indicators {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .indicator.active {
            background-color: white;
        }

        /* Category Filter */
        .category-filter {
            background-color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .category-list {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background-color: #e5e7eb;
            color: #374151;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .category-btn.active {
            background-color: #3b82f6;
            color: white;
        }

        .category-btn:hover {
            background-color: #d1d5db;
        }

        /* Products Grid */
        .section-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 30px;
            color: #1e293b;
        }

        .products-grid {
            display: grid;
            /* smaller cards to fit more items */
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 14px;
            margin-bottom: 30px;
        }

        .product-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
            transition: transform 0.18s, box-shadow 0.18s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }

        .product-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            position: relative;
        }

        .discount-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ef4444;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
        }

        .product-info {
            padding: 10px;
        }

        .product-name {
            font-weight: bold;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .product-rating {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .star {
            color: #fbbf24;
            margin-left: 2px;
        }

        .rating-text {
            margin-right: 5px;
            color: #6b7280;
            font-size: 0.9rem;
        }

        .product-price {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .price {
            color: #ef4444;
            font-weight: bold;
            font-size: 0.95rem;
        }

        .original-price {
            color: #9ca3af;
            text-decoration: line-through;
            margin-right: 10px;
            font-size: 0.9rem;
        }

        .buy-btn {
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.3s;
        }

        .buy-btn:hover {
            background-color: #2563eb;
        }

        /* Footer */
        footer {
            background-color: #1e293b;
            color: white;
            padding: 60px 0 30px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid #334155;
            color: #94a3b8;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .hero-slider { height: 260px; }
            .product-image { height: 110px; }
            .products-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            .search-box input {
                width: 140px;
            }

            .hero-slider { height: 220px; }
            .slide-content { padding: 12px; }
            .slide-content h2 { font-size: 1.2rem; }
            .slide-content p { font-size: 0.9rem; }

            /* make cards more compact on phones */
            .products-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
            .product-image { height: 100px; }
            .product-info { padding: 8px; }
            .product-name { font-size: 0.95rem; }
            .price { font-size: 0.95rem; }
        }

        @media (max-width: 420px) {
            .products-grid { grid-template-columns: 1fr; }
            .product-image { height: 160px; }
            .hero-slider { height: 180px; }
        }
        /* Product modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .product-modal {
            background: white;
            max-width: 900px;
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            gap: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .product-modal .left {
            flex: 1 1 50%;
            min-width: 280px;
            background: #fafafa;
            display:flex;
            align-items:center;
            justify-content:center;
            padding: 16px;
        }

        .product-modal .left img {
            max-width: 100%;
            max-height: 420px;
            object-fit: contain;
        }

        .product-modal .right {
            flex: 1 1 50%;
            padding: 20px;
        }

        .sizes-list {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .size-btn {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }

        .size-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">XYH</div>
                
                <nav class="nav-menu">
                    <a href="#" onclick="scrollToSection('home')">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a>
                    <a href="#" onclick="scrollToSection('gym')">ŸÖŸÑÿßÿ®ÿ≥ ÿ¨ŸäŸÖ</a>
                    <a href="#" onclick="scrollToSection('dresses')">ÿØÿ±Ÿäÿ≥ÿßÿ™ ÿ£ŸÜÿØŸäÿ©</a>
                    <a href="#" onclick="scrollToSection('printing')">ÿßŸÑÿ∑ÿ®ÿßÿπÿ©</a>
                    <a href="#" onclick="scrollToSection('random')">ÿ£ÿÆÿ±Ÿâ</a>
                </nav>
                
                <div class="header-actions">
                    <div class="search-box">
                        <input type="text" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨...">
                        <span class="search-icon">üîç</span>
                    </div>
                    
                    <a href="shoppingbasket.html" class="cart-btn" style="text-decoration: none;">
                        <span>üõí</span>
                        <span>0</span>
                    </a>
                    
                    <button class="mobile-menu-btn">‚ò∞</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Slider -->
    <section class="hero-slider">
        <div id="slides-container">
            <!-- Slides will be loaded here dynamically -->
        </div>
        
        <div class="slider-indicators" id="slider-indicators">
            <!-- Indicators will be loaded here dynamically -->
        </div>
    </section>

    <!-- Category Filter -->
    <section class="category-filter">
        <div class="container">
            <div class="category-list">
                <button class="category-btn active" onclick="filterProducts('all', this)">ÿßŸÑŸÉŸÑ</button>
                <button class="category-btn" onclick="filterProducts('gym', this)">ŸÖŸÑÿßÿ®ÿ≥ ÿ¨ŸäŸÖ</button>
                <button class="category-btn" onclick="filterProducts('dresses', this)">ÿØÿ±Ÿäÿ≥ÿßÿ™ ÿ£ŸÜÿØŸäÿ©</button>
                <button class="category-btn" onclick="filterProducts('printing', this)">ÿßŸÑÿ∑ÿ®ÿßÿπÿ©</button>
                <button class="category-btn" onclick="filterProducts('random', this)">ÿ£ÿÆÿ±Ÿâ</button>
            </div>
        </div>
    </section>

    <!-- Products Grid -->
    <section class="container">
        <h2 class="section-title">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</h2>
        <div class="products-grid" id="productsGrid">
            <!-- Products will be loaded here dynamically -->
        </div>
    </section>

    <!-- Category Sections -->
    <section id="gym" class="container">
        <h2 class="section-title">ŸÖŸÑÿßÿ®ÿ≥ ÿ¨ŸäŸÖ</h2>
        <div class="products-grid" id="gymProducts">
            <!-- Gym products will be loaded here -->
        </div>
    </section>

    <section id="dresses" class="container">
        <h2 class="section-title">ÿØÿ±Ÿäÿ≥ÿßÿ™ ÿ£ŸÜÿØŸäÿ©</h2>
        <div class="products-grid" id="dressesProducts">
            <!-- Dresses products will be loaded here -->
        </div>
    </section>

    <section id="printing" class="container">
        <h2 class="section-title">ÿßŸÑÿ∑ÿ®ÿßÿπÿ©</h2>
        <div class="products-grid" id="printingProducts">
            <!-- Printing products will be loaded here -->
        </div>
    </section>

    <section id="random" class="container">
        <h2 class="section-title">ÿ£ÿÆÿ±Ÿâ</h2>
        <div class="products-grid" id="randomProducts">
            <!-- Random products will be loaded here -->
        </div>
    </section>

    <!-- Footer -->
    <!-- Product Modal -->
    <div id="productModal" class="modal-overlay" onclick="if(event.target.id==='productModal') closeProductModal();">
        <div class="product-modal" role="dialog" aria-modal="true">
            <div class="left">
                <img id="modalImage" src="./assets/placeholder.svg" alt="ÿµŸàÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨">
            </div>
            <div class="right">
                <h2 id="modalName"></h2>
                <div style="margin-top:10px;font-size:1.05rem;color:#ef4444;font-weight:700" id="modalPrice"></div>
                <div style="margin-top:8px;color:#6b7280" id="modalCotton"></div>
                <div style="margin-top:12px">ÿßŸÑÿ£ÿ≠ÿ¨ÿßŸÖ:</div>
                <div id="modalSizes" class="sizes-list"></div>
                <div style="margin-top:16px">ÿßŸÑŸÉŸÖŸäÿ©:</div>
                <input id="modalQuantity" type="number" value="1" min="1" style="width:80px;margin-top:8px;padding:8px;border:1px solid #d1d5db;border-radius:6px">
                <div style="margin-top:18px;display:flex;gap:10px;align-items:center">
                    <button id="modalAddBtn" class="buy-btn">ÿ£ÿ∂ŸÅ ŸÑŸÑÿ≥ŸÑÿ©</button>
                    <button class="btn" onclick="closeProductModal()">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>XYH</h3>
                    <p>ŸÖÿ™ÿ¨ÿ±ŸÉ ÿßŸÑŸÖŸÅÿ∂ŸÑ ŸÑŸÑŸÖŸÑÿßÿ®ÿ≥ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿ© ŸàÿßŸÑÿØÿ±Ÿäÿ≥ÿßÿ™ ÿßŸÑŸÖÿÆÿµÿµÿ©</p>
                </div>
                
                <div class="footer-section">
                    <h3>ÿ±Ÿàÿßÿ®ÿ∑ ÿ≥ÿ±Ÿäÿπÿ©</h3>
                    <ul class="footer-links">
                        <li><a href="#">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a></li>
                        <li><a href="#gym">ŸÖŸÑÿßÿ®ÿ≥ ÿ¨ŸäŸÖ</a></li>
                        <li><a href="#dresses">ÿØÿ±Ÿäÿ≥ÿßÿ™ ÿ£ŸÜÿØŸäÿ©</a></li>
                        <li><a href="#printing">ÿßŸÑÿ∑ÿ®ÿßÿπÿ©</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>ÿßŸÑÿØÿπŸÖ</h3>
                    <ul class="footer-links">
                        <li><a href="#">ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©</a></li>
                        <li><a href="#">ÿßŸÑÿ¥ÿ≠ŸÜ</a></li>
                        <li><a href="#">ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπ</a></li>
                        <li><a href="#">ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÜÿß</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>ÿ™ÿßÿ®ÿπŸÜÿß</h3>
                    <p>ÿßÿ®ŸÇ ÿπŸÑŸâ ÿßÿ™ÿµÿßŸÑ ŸÖÿπ ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿπÿ±Ÿàÿ∂</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2024 XYH. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- Firebase initialization (paste your project's config into window.__FIREBASE_CONFIG__ before this script runs) ---
        (function(){
            const loadScript = (src) => new Promise((res, rej) => { const s = document.createElement('script'); s.src = src; s.onload = res; s.onerror = rej; document.head.appendChild(s); });
            Promise.all([
                loadScript('https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js'),
                loadScript('https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js')
            ]).then(() => {
                try {
                    const cfg = window.__FIREBASE_CONFIG__ || { apiKey:'', authDomain:'', projectId:'' };
                    if (cfg && cfg.projectId && cfg.apiKey) {
                        firebase.initializeApp(cfg);
                        window.__XYH_db = firebase.firestore();
                        console.log('Firebase initialized for storefront.');
                    } else {
                        window.__XYH_db = null;
                        console.warn('Firebase not configured for storefront ‚Äî using localStorage.');
                    }
                } catch (e) {
                    console.warn('Firebase init failed:', e);
                    window.__XYH_db = null;
                }
            }).catch(e => { console.warn('Could not load Firebase libs:', e); window.__XYH_db = null; });
        })();

            // --- JSONBin remote loader (optional) ---
            (function(){
                // window.__REMOTE_API_CONFIG = { type: 'jsonbin', binId: 'YOUR_BIN_ID', apiKey: 'YOUR_MASTER_KEY', autoPoll: false, pollInterval: 30 }
                // prefer explicit global, otherwise read saved config from localStorage
                const cfg = window.__REMOTE_API_CONFIG || (function(){
                    try { return JSON.parse(localStorage.getItem('remoteConfig') || 'null'); } catch(e){ return null; }
                })();
                window.__XYH_remote = window.__XYH_remote || {};

                async function loadRemoteProducts() {
                    if (!cfg) return null;
                    // If proxy is configured, use it (recommended)
                    if (cfg.proxyUrl) {
                        try {
                            const res = await fetch(cfg.proxyUrl, { method: 'GET' });
                            if (!res.ok) throw new Error('Proxy HTTP ' + res.status);
                            const json = await res.json();
                            const remoteProducts = json.products || json;
                            if (!remoteProducts || typeof remoteProducts !== 'object') throw new Error('Invalid products format from proxy');
                            localStorage.setItem('products', JSON.stringify(remoteProducts));
                            products = remoteProducts;
                            console.log('Loaded products from proxy:', remoteProducts);
                            const allProducts = [...products.gym || [], ...products.dresses || [], ...products.printing || [], ...products.random || []];
                            displayProducts(allProducts, 'productsGrid');
                            displayProducts(products.gym || [], 'gymProducts');
                            displayProducts(products.dresses || [], 'dressesProducts');
                            displayProducts(products.printing || [], 'printingProducts');
                            displayProducts(products.random || [], 'randomProducts');
                            return remoteProducts;
                        } catch (err) {
                            console.warn('Failed to load remote products from proxy:', err);
                            // fall through to jsonbin attempt if configured
                        }
                    }

                    // Fallback to jsonbin direct read
                    if (!cfg || cfg.type !== 'jsonbin' || !cfg.binId) return null;
                    const url = `https://api.jsonbin.io/v3/b/${cfg.binId}/latest`;
                    try {
                        const headers = { 'Accept': 'application/json' };
                        if (cfg.apiKey) headers['X-Master-Key'] = cfg.apiKey;
                        const res = await fetch(url, { method: 'GET', headers });
                        if (!res.ok) throw new Error('HTTP ' + res.status);
                        const json = await res.json();
                        // jsonbin returns data in `record` for v3; fall back to root
                        const record = json.record || json || null;
                        if (!record) throw new Error('No record in jsonbin response');

                        // if record contains the `products` object, use it; otherwise assume the record is the products object
                        const remoteProducts = record.products || record;
                        if (!remoteProducts || typeof remoteProducts !== 'object') throw new Error('Invalid products format from remote');

                        // persist locally and re-render
                        localStorage.setItem('products', JSON.stringify(remoteProducts));
                        products = remoteProducts;
                        console.log('Loaded products from jsonbin:', remoteProducts);

                        const allProducts = [...products.gym || [], ...products.dresses || [], ...products.printing || [], ...products.random || []];
                        displayProducts(allProducts, 'productsGrid');
                        displayProducts(products.gym || [], 'gymProducts');
                        displayProducts(products.dresses || [], 'dressesProducts');
                        displayProducts(products.printing || [], 'printingProducts');
                        displayProducts(products.random || [], 'randomProducts');

                        return remoteProducts;
                    } catch (err) {
                        console.warn('Failed to load remote products from jsonbin:', err);
                        return null;
                    }
                }

                window.__XYH_remote.loadProducts = loadRemoteProducts;

                // Add a small sync button next to cart to allow manual refresh from remote
                function addSyncButton() {
                    try {
                        const headerActions = document.querySelector('.header-actions');
                        if (!headerActions) return;
                        if (document.getElementById('syncRemoteBtn')) return; // already added
                        const btn = document.createElement('button');
                        btn.id = 'syncRemoteBtn';
                        btn.textContent = 'ŸÖÿ≤ÿßŸÖŸÜÿ©';
                        btn.style.padding = '8px 10px';
                        btn.style.borderRadius = '8px';
                        btn.style.border = '1px solid #d1d5db';
                        btn.style.background = 'white';
                        btn.style.cursor = 'pointer';
                        btn.onclick = async () => {
                            btn.disabled = true;
                            btn.textContent = 'ÿ¨ÿßÿ±Ÿç ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©...';
                            await loadRemoteProducts();
                            btn.textContent = 'ÿ™ŸÖ';
                            setTimeout(() => { btn.textContent = 'ŸÖÿ≤ÿßŸÖŸÜÿ©'; btn.disabled = false; }, 1200);
                        };
                        headerActions.insertBefore(btn, headerActions.firstChild);
                    } catch (e) { console.warn('Could not add sync button:', e); }
                }

                // auto-poll support if enabled in config
                if (cfg && cfg.type === 'jsonbin') {
                    // add buttons immediately (DOMContentLoaded may not have run yet ‚Äî safe to call)
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', () => { addRemoteConfigButton(); addSyncButton(); });
                    } else { addRemoteConfigButton(); addSyncButton(); }

                    if (cfg.autoPoll) {
                        const interval = (cfg.pollInterval && Number(cfg.pollInterval) > 5) ? Number(cfg.pollInterval) * 1000 : 30000;
                        setInterval(() => {
                            loadRemoteProducts();
                        }, interval);
                    }
                }
            })();

            // add a small UI to set remote config (binId/apiKey) and save to localStorage
            function addRemoteConfigButton() {
                try {
                    const headerActions = document.querySelector('.header-actions');
                    if (!headerActions) return;
                    if (document.getElementById('remoteConfigBtn')) return;
                    const cfgBtn = document.createElement('button');
                    cfgBtn.id = 'remoteConfigBtn';
                    cfgBtn.textContent = 'ÿ™ŸÉŸàŸäŸÜ ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©';
                    cfgBtn.style.padding = '8px 10px';
                    cfgBtn.style.borderRadius = '8px';
                    cfgBtn.style.border = '1px solid #d1d5db';
                    cfgBtn.style.background = 'white';
                    cfgBtn.style.cursor = 'pointer';
                    cfgBtn.onclick = function() {
                        const bin = prompt('ÿ£ÿØÿÆŸÑ binId ŸÖŸÜ jsonbin (ÿ£Ÿà ÿßÿ™ÿ±ŸÉ ŸÅÿßÿ±ÿ∫ ŸÑŸÑÿ™ÿπÿ∑ŸäŸÑ):', (window.__REMOTE_API_CONFIG && window.__REMOTE_API_CONFIG.binId) || '');
                        if (!bin) {
                            localStorage.removeItem('remoteConfig');
                            window.__REMOTE_API_CONFIG = null;
                            alert('ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑÿ®ÿπŸäÿØÿ©');
                            return;
                        }
                        const key = prompt('ÿ£ÿØÿÆŸÑ X-Master-Key (master key) ŸÖŸÜ jsonbin:', (window.__REMOTE_API_CONFIG && window.__REMOTE_API_CONFIG.apiKey) || '');
                        const cfg = { type: 'jsonbin', binId: bin.trim(), apiKey: key ? key.trim() : '', autoPoll: false };
                        localStorage.setItem('remoteConfig', JSON.stringify(cfg));
                        window.__REMOTE_API_CONFIG = cfg;
                        alert('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ© ŸÖÿ≠ŸÑŸäÿßŸã. ÿßÿ∂ÿ∫ÿ∑ ŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑÿ¢ŸÜ ŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™.');
                    };
                    headerActions.insertBefore(cfgBtn, headerActions.firstChild);
                } catch (e) { console.warn('Could not add remote config button:', e); }
            }

        // Format price function
        function formatPrice(price) {
            return new Intl.NumberFormat('ar-IQ').format(price);
        }
        let products = JSON.parse(localStorage.getItem('products')) || {
            gym: [
                { id: 1, name: "ÿ™Ÿäÿ¥ÿ±ÿ™ ÿ¨ŸäŸÖ ÿßÿ≥ŸàÿØ", price: 45000, originalPrice: 55000, image: "https://placehold.co/300x300/1f2937/ffffff?text=ÿ™Ÿäÿ¥ÿ±ÿ™+ÿßÿ≥ŸàÿØ", rating: 4.5 },
                { id: 2, name: "ÿ¥Ÿàÿ±ÿ™ ÿ¨ŸäŸÖ ÿ±Ÿäÿßÿ∂Ÿä", price: 60000, originalPrice: 70000, image: "https://placehold.co/300x300/374151/ffffff?text=ÿ¥Ÿàÿ±ÿ™+ÿ¨ŸäŸÖ", rating: 4.3 },
                { id: 3, name: "ŸÉŸÜÿ≤ÿ© ÿ¨ŸäŸÖ ÿ´ŸÇŸäŸÑÿ©", price: 80000, originalPrice: 100000, image: "https://placehold.co/300x300/4b5563/ffffff?text=ŸÉŸÜÿ≤ÿ©+ÿ¨ŸäŸÖ", rating: 4.7 },
                { id: 4, name: "ÿ¨ÿßŸÉÿ™ ÿ¨ŸäŸÖ ÿ±Ÿäÿßÿ∂Ÿä", price: 120000, originalPrice: 150000, image: "https://placehold.co/300x300/6b7280/ffffff?text=ÿ¨ÿßŸÉÿ™+ÿ¨ŸäŸÖ", rating: 4.6 }
            ],
            dresses: [
                { id: 5, name: "ÿØÿ±ÿ≥ÿ© ÿ±ŸäÿßŸÑ ŸÖÿØÿ±ŸäÿØ", price: 90000, originalPrice: 110000, image: "https://placehold.co/300x300/dc2626/ffffff?text=ÿ±ŸäÿßŸÑ+ŸÖÿØÿ±ŸäÿØ", rating: 4.8 },
                { id: 6, name: "ÿØÿ±ÿ≥ÿ© ÿ®ÿ±ÿ¥ŸÑŸàŸÜÿ©", price: 90000, originalPrice: 110000, image: "https://placehold.co/300x300/0ea5e9/ffffff?text=ÿ®ÿ±ÿ¥ŸÑŸàŸÜÿ©", rating: 4.7 },
                { id: 7, name: "ÿØÿ±ÿ≥ÿ© ŸÖÿßŸÜÿ¥ÿ≥ÿ™ÿ±", price: 85000, originalPrice: 100000, image: "https://placehold.co/300x300/3b82f6/ffffff?text=ŸÖÿßŸÜÿ¥ÿ≥ÿ™ÿ±", rating: 4.5 },
                { id: 8, name: "ÿØÿ±ÿ≥ÿ© ŸÑŸäŸÅÿ±ÿ®ŸàŸÑ", price: 85000, originalPrice: 100000, image: "https://placehold.co/300x300/ef4444/ffffff?text=ŸÑŸäŸÅÿ±ÿ®ŸàŸÑ", rating: 4.6 }
            ],
            printing: [
                { id: 9, name: "ÿ™Ÿäÿ¥ÿ±ÿ™ ÿ∑ÿ®ÿßÿπÿ© ŸÖÿÆÿµÿµÿ©", price: 50000, originalPrice: 65000, image: "https://placehold.co/300x300/8b5cf6/ffffff?text=ÿ™Ÿäÿ¥ÿ±ÿ™+ŸÖÿÆÿµÿµ", rating: 4.4 },
                { id: 10, name: "ŸáŸàÿØŸä ÿ∑ÿ®ÿßÿπÿ© ŸÖÿÆÿµÿµÿ©", price: 75000, originalPrice: 90000, image: "https://placehold.co/300x300/a855f7/ffffff?text=ŸáŸàÿØŸä+ŸÖÿÆÿµÿµ", rating: 4.5 },
                { id: 11, name: "ÿ™Ÿäÿ¥ÿ±ÿ™ ŸÅÿ±ŸäŸÇ ŸÖÿÆÿµÿµ", price: 55000, originalPrice: 70000, image: "https://placehold.co/300x300/c084fc/ffffff?text=ÿ™Ÿäÿ¥Ÿäÿ±ÿ™+ŸÅÿ±ŸäŸÇ", rating: 4.3 },
                { id: 12, name: "ÿ™Ÿäÿ¥ÿ±ÿ™ ÿ™ÿµŸÖŸäŸÖ ÿ≠ÿ±", price: 45000, originalPrice: 60000, image: "https://placehold.co/300x300/d8b4fe/ffffff?text=ÿ™ÿµŸÖŸäŸÖ+ÿ≠ÿ±", rating: 4.2 }
            ],
            random: [
                { id: 13, name: "ŸÇÿ®ÿπÿ© ÿ±Ÿäÿßÿ∂Ÿäÿ©", price: 35000, originalPrice: 45000, image: "https://placehold.co/300x300/000000/ffffff?text=ŸÇÿ®ÿπÿ©", rating: 4.1 },
                { id: 14, name: "ÿ≠ŸÇŸäÿ®ÿ© ÿ±Ÿäÿßÿ∂Ÿäÿ©", price: 70000, originalPrice: 85000, image: "https://placehold.co/300x300/1e293b/ffffff?text=ÿ≠ŸÇŸäÿ®ÿ©", rating: 4.4 },
                { id: 15, name: "ÿ≥ÿßÿπÿ© ÿ∞ŸÉŸäÿ©", price: 150000, originalPrice: 200000, image: "https://placehold.co/300x300/334155/ffffff?text=ÿ≥ÿßÿπÿ©", rating: 4.6 },
                { id: 16, name: "ÿ≤Ÿàÿ¨ ÿßÿ≠ÿ∞Ÿäÿ© ÿ±Ÿäÿßÿ∂Ÿäÿ©", price: 180000, originalPrice: 220000, image: "https://placehold.co/300x300/475569/ffffff?text=ÿßÿ≠ÿ∞Ÿäÿ©", rating: 4.8 }
            ]
        };

    // Current slide index
    let currentSlide = 0;
    // will hold references to DOM slide/indicator elements (populated after loadSlides runs)
    let slideElements = [];
    let indicatorElements = [];

        // Load slides from localStorage
        function loadSlides() {
            const slides = JSON.parse(localStorage.getItem('slides')) || [
                {
                    id: 1,
                    title: "ÿ™Ÿäÿ¥ÿ±ÿ™ÿßÿ™ ŸÖÿÆÿµÿµÿ©",
                    subtitle: "ÿßÿ∑ÿ®ÿπ ŸÖÿß ÿ™ÿ≠ÿ® ÿπŸÑŸâ ÿ™Ÿäÿ¥ÿ±ÿ™ŸÉ",
                    image: "https://placehold.co/1200x500/4f46e5/ffffff?text=ÿ™ÿÆÿµŸäÿµ+ÿ™Ÿäÿ¥ÿ±ÿ™ÿßÿ™",
                    discount: "20%"
                },
                {
                    id: 2,
                    title: "ŸÖŸÑÿßÿ®ÿ≥ ÿ¨ŸäŸÖ",
                    subtitle: "ÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ© Ÿàÿ±ÿßÿ≠ÿ© ÿ™ÿßŸÖÿ©",
                    image: "https://placehold.co/1200x500/10b981/ffffff?text=ŸÖŸÑÿßÿ®ÿ≥+ÿ¨ŸäŸÖ",
                    discount: "15%"
                },
                {
                    id: 3,
                    title: "ÿØÿ±Ÿäÿ≥ÿßÿ™ ÿ£ŸÜÿØŸäÿ©",
                    subtitle: "ÊîØÊåÅÂäõÂ∫¶ ÿßŸÜÿØŸäÿ©ŸÉ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©",
                    image: "https://placehold.co/1200x500/f59e0b/ffffff?text=ÿØÿ±Ÿäÿ≥ÿßÿ™+ÿ£ŸÜÿØŸäÿ©",
                    discount: "25%"
                }
            ];

            const slidesContainer = document.getElementById('slides-container');
            const indicatorsContainer = document.getElementById('slider-indicators');
            
            // Clear existing content
            slidesContainer.innerHTML = '';
            indicatorsContainer.innerHTML = '';
            
            // Add slides
            slides.forEach((slide, index) => {
                const slideElement = document.createElement('div');
                slideElement.className = `slide ${index === 0 ? 'active' : ''}`;
                slideElement.style.backgroundImage = `url('${slide.image}')`;
                
                slideElement.innerHTML = `
                    <div class="slide-content">
                        <h2>${slide.title}</h2>
                        <p>${slide.subtitle}</p>
                
                    </div>
                `;
                
                slidesContainer.appendChild(slideElement);
                
                // Add indicator
                const indicator = document.createElement('div');
                indicator.className = `indicator ${index === 0 ? 'active' : ''}`;
                indicator.onclick = () => changeSlide(index);
                indicatorsContainer.appendChild(indicator);
            });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑÿ≥ŸÑÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartBtn = document.querySelector('.cart-btn span:last-child');
            if (cartBtn) {
                const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
                cartBtn.textContent = totalItems;
            }

            loadAllProducts();
            loadSlides();
            startSlider();
        });

        // Update cart count
        function updateCartCount() {
            try {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                const cartBtn = document.querySelector('.cart-btn span:last-child');
                if (cartBtn) {
                    const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
                    cartBtn.textContent = totalItems;
                    console.log('updateCartCount:', totalItems);
                }
            } catch (error) {
                console.error('Error updating cart count:', error);
            }
        }

        // Load all products
        function loadAllProducts() {
            // If Firestore is available, listen for real-time updates and build products object
            const db = window.__XYH_db;
            if (db) {
                // listen once and also on subsequent changes
                db.collection('products').onSnapshot(snapshot => {
                    // rebuild products object
                    const newProducts = { gym: [], dresses: [], printing: [], random: [] };
                    try {
                        snapshot.forEach(doc => {
                            const p = doc.data();
                            // ensure category exists
                            const cat = p.category || 'random';
                            if (!newProducts[cat]) newProducts[cat] = [];
                            // local compatibility: ensure image field present
                            if ((!p.image || p.image === '') && p.images && p.images.length) p.image = p.images[0];
                            newProducts[cat].push(p);
                        });
                    } catch (err) {
                        console.error('Error processing Firestore products snapshot:', err);
                    }
                    products = newProducts;
                    // Diagnostic logging
                    console.groupCollapsed('Products (Firestore) debug');
                    console.log('products from Firestore:', products);
                    console.groupEnd();

                    const allProducts = [...products.gym, ...products.dresses, ...products.printing, ...products.random];
                    displayProducts(allProducts, 'productsGrid');
                    displayProducts(products.gym, 'gymProducts');
                    displayProducts(products.dresses, 'dressesProducts');
                    displayProducts(products.printing, 'printingProducts');
                    displayProducts(products.random, 'randomProducts');
                }, err => {
                    console.error('Firestore onSnapshot error:', err);
                });
                return;
            }

            // Fallback: Refresh products data from localStorage
            products = JSON.parse(localStorage.getItem('products')) || { gym: [], dresses: [], printing: [], random: [] };
            // Diagnostic logging to help debug missing images
            try {
                console.groupCollapsed('Products debug');
                console.log('products (raw from localStorage):', products);
                const counts = { total: 0, withImage: 0, withoutImage: 0, stripped: 0 };
                Object.values(products).flat().forEach(p => {
                    counts.total++;
                    if (p.image && p.image.length) counts.withImage++;
                    else counts.withoutImage++;
                    if (p._imageStripped) counts.stripped++;
                });
                console.log('product image counts:', counts);
                console.groupEnd();
            } catch (e) {
                console.error('Error logging products debug:', e);
            }
            const allProducts = [...products.gym, ...products.dresses, ...products.printing, ...products.random];
            displayProducts(allProducts, 'productsGrid');
            
            // Load category-specific products
            displayProducts(products.gym, 'gymProducts');
            displayProducts(products.dresses, 'dressesProducts');
            displayProducts(products.printing, 'printingProducts');
            displayProducts(products.random, 'randomProducts');
        }

        // Display products in a grid
        function displayProducts(productsArray, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            productsArray.forEach(product => {
                const discount = product.originalPrice > product.price ? 
                    Math.round((1 - product.price / product.originalPrice) * 100) : 0;

                // Use a local placeholder when image is missing or was stripped to avoid broken images / quota issues
                const placeholder = './assets/placeholder.svg';
                // prefer new `images` array (multiple images), fall back to `image`
                const imgSrc = (product.images && product.images.length) ? product.images[0] : ((product.image && product.image.length) ? product.image : placeholder);

                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                // clicking the card opens a larger modal view where user can choose size and add to cart
                productCard.innerHTML = `
                    <div class="product-image-container">
                        <img src="${imgSrc}" alt="${product.name}" class="product-image" onerror="this.onerror=null;this.src='${placeholder}';">
                        
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">
                            <div>
                                <span class="price">${formatPrice(product.price)} ÿØ.ÿπ</span>
                            </div>
                            <div style="color:#6b7280;font-size:0.85rem">${product.cottonQuality || ''}</div>
                        </div>
                    </div>
                `;
                productCard.setAttribute('data-id', product.id);
                productCard.addEventListener('click', () => openProductModal(product.id));
                container.appendChild(productCard);
            });
        }

        // Generate star rating HTML
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += i <= Math.floor(rating) ? 
                    '<span class="star">‚òÖ</span>' : 
                    '<span class="star" style="color: #d1d5db;">‚òÖ</span>';
            }
            return stars;
        }

        // Filter products by category
        function filterProducts(category, clickedBtn) {
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (clickedBtn && clickedBtn.classList) clickedBtn.classList.add('active');

            // Load products based on category
            if (category === 'all') {
                loadAllProducts();
            } else {
                displayProducts(products[category] || [], 'productsGrid');
            }
        }

        // Add to cart function (accepts optional chosenSize and chosenImage)
        function addToCart(productId, chosenSize, chosenImage) {
            // Get cart from localStorage or create new one
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            // Find the product from all products
            const allProducts = Object.values(products).flat();
            const product = allProducts.find(p => p.id === productId);
            
            if (product) {
                // Use chosenSize if provided; otherwise undefined
                const size = chosenSize || '';
                // determine image to store: prefer chosenImage, then product.images[0], then product.image
                const imgToUse = chosenImage || ((product.images && product.images.length) ? product.images[0] : (product.image || ''));
                // Check if product with same size already exists in cart
                const existingItem = cart.find(item => item.id === productId && (item.size || '') === size && (item.image || '') === imgToUse);

                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        image: imgToUse,
                        size: size,
                        quantity: 1
                    });
                }
                
                // Prepare a sanitized copy for storage (avoid storing huge data-URLs)
                function sanitizeForStorage(cartArray) {
                    return cartArray.map(item => {
                        const img = item.image || '';
                        // if image is a data URL (base64) and very large, drop it to avoid exceeding quota
                        if (typeof img === 'string' && img.startsWith('data:')) {
                            // threshold ~150 KB
                            if (img.length > 150000) {
                                return Object.assign({}, item, { image: '' });
                            }
                        }
                        return item;
                    });
                }

                const cartForStorage = sanitizeForStorage(cart);

                try {
                    localStorage.setItem('cart', JSON.stringify(cartForStorage));
                } catch (err) {
                    console.error('localStorage.setItem failed:', err);
                    // Try a fallback: strip images entirely and try again
                    if (err && (err.name === 'QuotaExceededError' || err.code === 22 || err.number === -2147024882)) {
                        try {
                            const stripped = cart.map(({ id, name, price, quantity }) => ({ id, name, price, quantity }));
                            localStorage.setItem('cart', JSON.stringify(stripped));
                            // update in-memory cart to reflect stripped images so UI doesn't re-save big data
                            cart = cart.map(i => Object.assign({}, i, { image: '' }));
                            console.warn('Cart saved without images due to storage quota.');
                        } catch (err2) {
                            console.error('Fallback save also failed:', err2);
                            alert('ÿ™ÿπÿ∞ÿ± ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÑÿ© ŸÖÿ≠ŸÑŸäÿßŸã ŸÑÿ£ŸÜ ÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÖŸÖÿ™ŸÑÿ¶ÿ©. ÿ≠ÿßŸàŸÑ ÿ™ŸÅÿ±Ÿäÿ∫ ÿ®ÿπÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ÿ£Ÿà ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ™ÿµŸÅÿ≠ ÿ¢ÿÆÿ±.');
                        }
                    } else {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ŸÑÿ©. ÿ±ÿßÿ¨ÿπ ÿßŸÑŸÉŸàŸÜÿ≥ŸàŸÑ ŸÑŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ.');
                    }
                }

                // Update cart count and UI
                updateCartCount();
                console.log('addToCart: cart updated (in-memory):', cart);

                alert('ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©!');
            }
        }

        // Slider functionality
        function startSlider() {
            // (re)query slide elements in case they were created dynamically
            slideElements = document.querySelectorAll('.slide');
            indicatorElements = document.querySelectorAll('.indicator');

            if (!slideElements || slideElements.length === 0) return;

            setInterval(() => {
                currentSlide = (currentSlide + 1) % slideElements.length;
                updateSlider();
            }, 4000);
        }

        function changeSlide(index) {
            currentSlide = index;
            updateSlider();
        }

        function updateSlider() {
            // ensure we have fresh references
            slideElements = document.querySelectorAll('.slide');
            indicatorElements = document.querySelectorAll('.indicator');

            slideElements.forEach((slide, index) => {
                slide.classList.toggle('active', index === currentSlide);
            });

            indicatorElements.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentSlide);
            });
        }

        // Scroll to section
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Mobile menu toggle
        document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
            const navMenu = document.querySelector('.nav-menu');
            navMenu.style.display = navMenu.style.display === 'flex' ? 'none' : 'flex';
        });

        // Product modal logic
        function openProductModal(productId) {
            const allProducts = Object.values(products).flat();
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const placeholder = './assets/placeholder.svg';
            // gather images (product may have images[] or single image)
            const imgs = (product.images && product.images.length) ? product.images.slice() : (product.image ? [product.image] : []);
            let selectedImage = imgs.length ? imgs[0] : placeholder;
            document.getElementById('modalImage').src = selectedImage;
            document.getElementById('modalImage').alt = product.name;
            document.getElementById('modalName').textContent = product.name;
            document.getElementById('modalPrice').textContent = formatPrice(product.price) + ' ÿØ.ÿπ';
            document.getElementById('modalCotton').textContent = product.cottonQuality ? 'ŸÜŸàÿπ ÿßŸÑŸÇÿ∑ŸÜ: ' + product.cottonQuality : '';
            document.getElementById('modalQuantity').value = 1;

            // render thumbnails area inside left column (create if missing)
            const leftCol = document.querySelector('.product-modal .left');
            let thumbs = document.getElementById('modalThumbnails');
            if (!thumbs) {
                thumbs = document.createElement('div');
                thumbs.id = 'modalThumbnails';
                thumbs.style.display = 'flex';
                thumbs.style.gap = '8px';
                thumbs.style.marginTop = '10px';
                thumbs.style.flexWrap = 'wrap';
                leftCol.appendChild(thumbs);
            }
            thumbs.innerHTML = '';
            imgs.forEach((src, idx) => {
                const t = document.createElement('img');
                t.src = src;
                t.alt = product.name + ' - ' + (idx+1);
                t.style.width = '64px';
                t.style.height = '64px';
                t.style.objectFit = 'cover';
                t.style.border = (src === selectedImage) ? '2px solid #3b82f6' : '1px solid #e5e7eb';
                t.style.borderRadius = '6px';
                t.style.cursor = 'pointer';
                t.addEventListener('click', () => {
                    selectedImage = src;
                    document.getElementById('modalImage').src = selectedImage;
                    // update borders
                    Array.from(thumbs.children).forEach(ch => ch.style.border = '1px solid #e5e7eb');
                    t.style.border = '2px solid #3b82f6';
                });
                thumbs.appendChild(t);
            });

            // render sizes
            const sizesContainer = document.getElementById('modalSizes');
            sizesContainer.innerHTML = '';
            let selectedSize = '';
            if (product.sizes && product.sizes.length) {
                product.sizes.forEach(sz => {
                    const b = document.createElement('button');
                    b.type = 'button';
                    b.className = 'size-btn';
                    b.textContent = sz;
                    b.addEventListener('click', () => {
                        // toggle active class
                        Array.from(sizesContainer.children).forEach(c => c.classList.remove('active'));
                        b.classList.add('active');
                        selectedSize = sz;
                    });
                    sizesContainer.appendChild(b);
                });
            } else {
                const p = document.createElement('div');
                p.style.color = '#6b7280';
                p.textContent = 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                sizesContainer.appendChild(p);
            }

            // hook add button
            const addBtn = document.getElementById('modalAddBtn');
            addBtn.onclick = function() {
                const qty = parseInt(document.getElementById('modalQuantity').value) || 1;
                // if product has sizes and none selected, alert
                if (product.sizes && product.sizes.length && !selectedSize) {
                    alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ≠ÿ¨ŸÖ ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©');
                    return;
                }
                // determine image to use (selectedImage variable)
                const imgToUse = selectedImage || '';
                // add item with selected size and image
                addToCart(product.id, selectedSize, imgToUse);
                // set the last added item's quantity to qty (if >1)
                if (qty > 1) {
                    let cart = JSON.parse(localStorage.getItem('cart')) || [];
                    // find item by id, size and image
                    const it = cart.find(i => i.id === product.id && (i.size || '') === (selectedSize || '') && (i.image || '') === imgToUse);
                    if (it) it.quantity = qty;
                    try {
                        localStorage.setItem('cart', JSON.stringify(cart));
                    } catch (e) {
                        console.warn('Could not save cart quantity change:', e);
                    }
                }
                updateCartCount();
                closeProductModal();
                alert('ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©');
            };

            document.getElementById('productModal').classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
        }
    </script>
</body>
</html>

